{"ast":null,"code":"import React,{useEffect,useRef,useState}from\"react\";import{loadPaymentWidget}from\"@tosspayments/payment-widget-sdk\";import{nanoid}from\"nanoid\";import{useLocation,useNavigate}from\"react-router-dom\";import axios from\"axios\";import{API_URL}from\"../../config/contansts\";import{errHandler}from'../../utils/globalFunction';import{useRecoilState}from\"recoil\";import{loginState}from\"../../recoil/atoms/State\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const clientKey=\"test_ck_yL0qZ4G1VOaGZY0qRkGk8oWb2MQY\";const customerKey=\"test_sk_DpexMgkW367N2GPKmowBVGbR5ozO\";export default function Payment(){const navigate=useNavigate();const[islogin,setIslogin]=useRecoilState(loginState);//useState와 거의 비슷한 사용법\nconst{state}=useLocation();console.log(state);const paymentWidgetRef=useRef(null);const paymentMethodsWidgetRef=useRef(null);const[price,setPrice]=useState(state.total_price);const[menus,setMenus]=useState(state.menu_items);useEffect(()=>{(async()=>{const paymentWidget=await loadPaymentWidget(clientKey,customerKey);const paymentMethodsWidget=paymentWidget.renderPaymentMethods(\"#payment-widget\",price);paymentWidgetRef.current=paymentWidget;paymentMethodsWidgetRef.current=paymentMethodsWidget;})();},[]);useEffect(()=>{const paymentMethodsWidget=paymentMethodsWidgetRef.current;if(paymentMethodsWidget==null){return;}paymentMethodsWidget.updateAmount(price,paymentMethodsWidget.UPDATE_REASON.COUPON);},[price]);return/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',margin:'10vw auto 5vw',maxWidth:'600px',padding:'20px',border:'1px solid #ddd',borderRadius:'8px',boxShadow:'0 0 10px rgba(0, 0, 0, 0.1)'},children:[/*#__PURE__*/_jsx(\"h1\",{style:{color:'#333',marginBottom:'1vw'},children:\"\\uC8FC\\uBB38\\uC11C\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:'bold',marginRight:'5px'},children:menus[0].name}),menus.length>1&&/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uC678 \",menus.length-1,\"\\uAC1C\"]})]}),/*#__PURE__*/_jsxs(\"h2\",{style:{color:'#555',marginBottom:'20px'},children:[\"\\uAC00\\uACA9: \",price]}),/*#__PURE__*/_jsx(\"div\",{id:\"payment-widget\",style:{margin:'20px 0'}}),/*#__PURE__*/_jsx(\"p\",{children:\"\\uD1A0\\uC2A4\\uD398\\uC774 \\uACB0\\uC81C\\uB9CC \\uAC00\\uB2A5\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\uD14C\\uC2A4\\uD2B8\\uC6A9\\uC73C\\uB85C \\uACB0\\uC81C \\uC131\\uACF5\\uD574\\uB3C4 \\uB3C8 \\uC548\\uB098\\uAC10\"}),/*#__PURE__*/_jsx(\"button\",{style:{padding:\"10px 20px\",fontSize:\"16px\",backgroundColor:\"#4CAF50\",color:\"white\",border:\"none\",borderRadius:\"5px\",cursor:\"pointer\"},onClick:async()=>{const paymentWidget=paymentWidgetRef.current;await(paymentWidget===null||paymentWidget===void 0?void 0:paymentWidget.requestPayment({orderId:nanoid(),orderName:\"맨토스\",customerName:\"김토스\",customerEmail:\"customer123@gmail.com\"}).then(()=>{console.log(\"res\");axios.post(\"\".concat(API_URL,\"/api/order\"),state).then(res=>{console.log(\"주문성공: \",res.data);sessionStorage.clear();navigate(\"/success\");}).catch(err=>{alert(\"\\uC5D0\\uB7EC: \".concat(err));console.error(err);setIslogin(false);errHandler(err);});}).catch(err=>{console.error(err);if(err.code===\"USER_CANCEL\"){console.log(\"사용자가 결제 취소\");}else{alert(\"결제실패!\");navigate(\"/fail\");}}));},children:\"\\uACB0\\uC81C\\uD558\\uAE30\"})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","loadPaymentWidget","nanoid","useLocation","useNavigate","axios","API_URL","errHandler","useRecoilState","loginState","jsx","_jsx","jsxs","_jsxs","clientKey","customerKey","Payment","navigate","islogin","setIslogin","state","console","log","paymentWidgetRef","paymentMethodsWidgetRef","price","setPrice","total_price","menus","setMenus","menu_items","paymentWidget","paymentMethodsWidget","renderPaymentMethods","current","updateAmount","UPDATE_REASON","COUPON","style","textAlign","margin","maxWidth","padding","border","borderRadius","boxShadow","children","color","marginBottom","fontWeight","marginRight","name","length","id","fontSize","backgroundColor","cursor","onClick","requestPayment","orderId","orderName","customerName","customerEmail","then","post","concat","res","data","sessionStorage","clear","catch","err","alert","error","code"],"sources":["C:/Users/user/Desktop/mcdonald-ec2/client/src/page/Payment/Payment.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { loadPaymentWidget, PaymentWidgetInstance } from \"@tosspayments/payment-widget-sdk\";\r\nimport { nanoid } from \"nanoid\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { API_URL } from \"../../config/contansts\";\r\nimport { errHandler } from '../../utils/globalFunction';\r\nimport { useRecoilState } from \"recoil\";\r\nimport { loginState } from \"../../recoil/atoms/State\";\r\n\r\nconst clientKey = \"test_ck_yL0qZ4G1VOaGZY0qRkGk8oWb2MQY\";\r\nconst customerKey = \"test_sk_DpexMgkW367N2GPKmowBVGbR5ozO\";\r\n\r\nexport default function Payment() {\r\n  const navigate = useNavigate();\r\n  const [islogin, setIslogin] = useRecoilState(loginState); //useState와 거의 비슷한 사용법\r\n  const { state } = useLocation();\r\n  console.log(state);\r\n\r\n  const paymentWidgetRef = useRef<PaymentWidgetInstance | null>(null);\r\n  const paymentMethodsWidgetRef = useRef<ReturnType<PaymentWidgetInstance[\"renderPaymentMethods\"]> | null>(null);\r\n  const [price, setPrice] = useState(state.total_price);\r\n  const [menus, setMenus] = useState(state.menu_items);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const paymentWidget = await loadPaymentWidget(clientKey, customerKey);\r\n\r\n      const paymentMethodsWidget = paymentWidget.renderPaymentMethods(\"#payment-widget\", price);\r\n\r\n      paymentWidgetRef.current = paymentWidget;\r\n      paymentMethodsWidgetRef.current = paymentMethodsWidget;\r\n    })();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const paymentMethodsWidget = paymentMethodsWidgetRef.current;\r\n\r\n    if (paymentMethodsWidget == null) {\r\n      return;\r\n    }\r\n\r\n    paymentMethodsWidget.updateAmount(price, paymentMethodsWidget.UPDATE_REASON.COUPON);\r\n  }, [price]);\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        textAlign: 'center',\r\n        margin: '10vw auto 5vw',\r\n        maxWidth: '600px',\r\n        padding: '20px',\r\n        border: '1px solid #ddd',\r\n        borderRadius: '8px',\r\n        boxShadow: '0 0 10px rgba(0, 0, 0, 0.1)',\r\n      }}\r\n    >\r\n      <h1 style={{ color: '#333', marginBottom: '1vw' }}>주문서</h1>\r\n      <div style={{ marginBottom: '10px' }}>\r\n        <span style={{ fontWeight: 'bold', marginRight: '5px' }}>{menus[0].name}</span>\r\n        {menus.length > 1 && <span>외 {menus.length - 1}개</span>}\r\n      </div>\r\n      <h2 style={{ color: '#555', marginBottom: '20px' }}>가격: {price}</h2>\r\n      <div id=\"payment-widget\" style={{ margin: '20px 0' }} />\r\n      <p>토스페이 결제만 가능</p>\r\n      <p>테스트용으로 결제 성공해도 돈 안나감</p>\r\n      <button\r\n        style={{\r\n          padding: \"10px 20px\",\r\n          fontSize: \"16px\",\r\n          backgroundColor: \"#4CAF50\",\r\n          color: \"white\",\r\n          border: \"none\",\r\n          borderRadius: \"5px\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        onClick={async () => {\r\n          const paymentWidget = paymentWidgetRef.current;\r\n          await paymentWidget\r\n            ?.requestPayment({\r\n              orderId: nanoid(),\r\n              orderName: \"맨토스\",\r\n              customerName: \"김토스\",\r\n              customerEmail: \"customer123@gmail.com\",\r\n            })\r\n            .then(() => {\r\n              console.log(\"res\");\r\n              axios\r\n                .post(`${API_URL}/api/order`, state)\r\n                .then((res) => {\r\n                  console.log(\"주문성공: \", res.data);\r\n                  sessionStorage.clear();\r\n                  navigate(\"/success\");\r\n                })\r\n                .catch((err) => {\r\n                  alert(`에러: ${err}`);\r\n                  console.error(err);\r\n                  setIslogin(false);\r\n                  errHandler(err);\r\n                });\r\n            })\r\n            .catch((err) => {\r\n              console.error(err);\r\n              if (err.code === \"USER_CANCEL\") {\r\n                console.log(\"사용자가 결제 취소\");\r\n              } else {\r\n                alert(\"결제실패!\");\r\n                navigate(\"/fail\");\r\n              }\r\n            });\r\n        }}\r\n      >\r\n        결제하기\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}