{"ast":null,"code":"import axios from'axios';import React,{useState,useEffect,useRef}from'react';import{NavLink}from'react-router-dom';import{API_URL}from'../../config/contansts';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const Slider=()=>{const[imagesAndVideos,setImagesAndVideos]=useState([]);const[currentIndex,setCurrentIndex]=useState(0);const[isPlaying,setIsPlaying]=useState(true);const[timers,setTimers]=useState([]);const sliderRef=useRef(null);useEffect(()=>{axios.get(\"\".concat(API_URL,\"/api/slider\")).then(res=>{console.log(res);setImagesAndVideos(res.data);setTimers(res.data.map(()=>({duration:0,progress:0})));}).catch(err=>{console.log(err);});},[]);console.log(imagesAndVideos);console.log(\"timers: \",timers);useEffect(()=>{var _imagesAndVideos$curr;const interval=setInterval(()=>{if(isPlaying){setCurrentIndex(prevIndex=>(prevIndex+1)%imagesAndVideos.length);}},((_imagesAndVideos$curr=imagesAndVideos[currentIndex])===null||_imagesAndVideos$curr===void 0?void 0:_imagesAndVideos$curr.duration)||5000);setTimers(prevTimers=>{const newTimers=prevTimers.map((timer,index)=>({duration:imagesAndVideos[index].duration,progress:index===currentIndex?timer.progress+1000:timer.progress}));return newTimers;});return()=>clearInterval(interval);},[currentIndex,isPlaying,imagesAndVideos]);const handleNext=()=>{setCurrentIndex(prevIndex=>(prevIndex+1)%imagesAndVideos.length);};const handlePrev=()=>{setCurrentIndex(prevIndex=>(prevIndex-1+imagesAndVideos.length)%imagesAndVideos.length);};const handleVideoLoaded=index=>{const videoElement=sliderRef.current.children[index].querySelector('video');if(index===currentIndex&&imagesAndVideos[index].type==='video'){videoElement.currentTime=0;videoElement.load();videoElement.play();// 동영상 로드 후 재생\n}};const handleVideoEnded=()=>{// 동영상이 끝나면 다음 슬라이드로 넘어가기\nhandleNext();};return/*#__PURE__*/_jsxs(\"div\",{className:\"slider-container\",ref:sliderRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"prev-button\",onClick:handlePrev,children:\"\\u2039\"}),/*#__PURE__*/_jsx(\"button\",{className:\"next-button\",onClick:handleNext,children:\"\\u203A\"})]}),imagesAndVideos.map((item,index)=>/*#__PURE__*/_jsx(NavLink,{to:item.path,children:/*#__PURE__*/_jsxs(\"div\",{className:\"slide \".concat(index===currentIndex?'active':''),children:[item.type==='image'&&/*#__PURE__*/_jsx(\"img\",{src:API_URL+item.content_url,alt:\"Slide \".concat(index)}),item.type==='video'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"video\",{autoPlay:true,muted:true,loop:true,onLoadedMetadata:()=>handleVideoLoaded(index),onTimeUpdate:e=>{setTimers(prevTimers=>{const newTimers=[...prevTimers];newTimers[index].progress=e.target.currentTime*1000;return newTimers;});},onEnded:handleVideoEnded,children:/*#__PURE__*/_jsx(\"source\",{src:API_URL+item.content_url,type:\"video/mp4\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"timer\",style:{width:\"\".concat(timers[index].progress/timers[index].duration*110,\"%\"),transition:\"width \".concat(timers[index].duration/8000,\"s linear\")}})]})]})},index))]});};export default Slider;","map":{"version":3,"names":["axios","React","useState","useEffect","useRef","NavLink","API_URL","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Slider","imagesAndVideos","setImagesAndVideos","currentIndex","setCurrentIndex","isPlaying","setIsPlaying","timers","setTimers","sliderRef","get","concat","then","res","console","log","data","map","duration","progress","catch","err","_imagesAndVideos$curr","interval","setInterval","prevIndex","length","prevTimers","newTimers","timer","index","clearInterval","handleNext","handlePrev","handleVideoLoaded","videoElement","current","children","querySelector","type","currentTime","load","play","handleVideoEnded","className","ref","onClick","item","to","path","src","content_url","alt","autoPlay","muted","loop","onLoadedMetadata","onTimeUpdate","e","target","onEnded","style","width","transition"],"sources":["C:/Users/user/Desktop/mcdonald-ec2/client/src/components/Main/Slider.js"],"sourcesContent":["import axios from 'axios';\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { NavLink } from 'react-router-dom';\r\nimport { API_URL } from '../../config/contansts';\r\n\r\nconst Slider = () => {\r\n\r\n  const [imagesAndVideos, setImagesAndVideos] = useState([]);\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [isPlaying, setIsPlaying] = useState(true);\r\n  const [timers, setTimers] = useState([]);\r\n  const sliderRef = useRef(null);\r\n  \r\n  useEffect(() => {\r\n    axios.get(`${API_URL}/api/slider`)\r\n    .then(res => {\r\n      console.log(res);\r\n      setImagesAndVideos(res.data)\r\n      setTimers(res.data.map(() => ({ duration: 0, progress: 0 })))\r\n    }).catch(err => {\r\n      console.log(err);\r\n    })\r\n  },[])\r\n\r\n  console.log(imagesAndVideos)\r\n\r\n  \r\n  console.log(\"timers: \", timers)\r\n\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      if (isPlaying) {\r\n        setCurrentIndex((prevIndex) => (prevIndex + 1) % imagesAndVideos.length);\r\n      }\r\n    }, imagesAndVideos[currentIndex]?.duration || 5000);\r\n  \r\n    setTimers((prevTimers) => {\r\n      const newTimers = prevTimers.map((timer, index) => ({\r\n        duration: imagesAndVideos[index].duration,\r\n        progress: index === currentIndex ? timer.progress + 1000 : timer.progress,\r\n      }));\r\n      return newTimers;\r\n    });\r\n  \r\n    return () => clearInterval(interval);\r\n  }, [currentIndex, isPlaying, imagesAndVideos]);\r\n\r\n\r\n  const handleNext = () => {\r\n    setCurrentIndex((prevIndex) => (prevIndex + 1) % imagesAndVideos.length);\r\n  };\r\n\r\n  const handlePrev = () => {\r\n    setCurrentIndex((prevIndex) => (prevIndex - 1 + imagesAndVideos.length) % imagesAndVideos.length);\r\n  };\r\n\r\n  const handleVideoLoaded = (index) => {\r\n    const videoElement = sliderRef.current.children[index].querySelector('video');\r\n  \r\n    if (index === currentIndex && imagesAndVideos[index].type === 'video') {\r\n      videoElement.currentTime = 0;\r\n      videoElement.load();\r\n      videoElement.play(); // 동영상 로드 후 재생\r\n    }\r\n  };\r\n\r\n  const handleVideoEnded = () => {\r\n    // 동영상이 끝나면 다음 슬라이드로 넘어가기\r\n    handleNext();\r\n  };\r\n\r\n  return (\r\n    <div className=\"slider-container\" ref={sliderRef}>\r\n      <div className=\"button-container\">\r\n        <button className=\"prev-button\" onClick={handlePrev}>\r\n          &#8249;\r\n        </button>\r\n        <button className=\"next-button\" onClick={handleNext}>\r\n          &#8250;\r\n        </button>\r\n      </div>\r\n      {imagesAndVideos.map((item, index) => (\r\n        <NavLink to={item.path} key={index}>\r\n          <div className={`slide ${index === currentIndex ? 'active' : ''}`}>\r\n            {item.type === 'image' && <img src={API_URL+item.content_url} alt={`Slide ${index}`} />}\r\n            {item.type === 'video' && (\r\n              <>\r\n                <video\r\n                  autoPlay\r\n                  muted\r\n                  loop\r\n                  onLoadedMetadata={() => handleVideoLoaded(index)}\r\n                  onTimeUpdate={(e) => {\r\n                    setTimers((prevTimers) => {\r\n                      const newTimers = [...prevTimers];\r\n                      newTimers[index].progress = e.target.currentTime * 1000;\r\n                      return newTimers;\r\n                    });\r\n                  }}\r\n                  onEnded={handleVideoEnded}\r\n                >\r\n                  <source src={API_URL+item.content_url} type=\"video/mp4\" />\r\n                </video>\r\n                <div\r\n                  className=\"timer\"\r\n                  style={{\r\n                    width: `${(timers[index].progress / timers[index].duration) * 110}%`,\r\n                    transition: `width ${timers[index].duration / 8000}s linear`,\r\n                  }}\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n        </NavLink>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Slider;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}